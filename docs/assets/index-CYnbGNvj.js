(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const X="https://wnwftbamyaotqdsivmas.supabase.co",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indud2Z0YmFteWFvdHFkc2l2bWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1OTY0OTcsImV4cCI6MjA3OTE3MjQ5N30.r8Fh7FUYOnUQHboqfKI1eb_37NLuAn3gRLbH8qUPpMo";let i,g=[];try{if(!window.supabase)throw new Error("Librer칤a Supabase no encontrada.");i=window.supabase.createClient(X,Z)}catch(t){console.error("Error Fatal: Supabase no inicializ칩.",t),document.getElementById("auth-container").style.display="flex",document.getElementById("main-app-content").style.display="none"}function v(t){const e=document.getElementById(t);e&&(e.classList.remove("hidden"),e.classList.add("flex"))}function f(t){const e=document.getElementById(t);if(e){e.classList.add("hidden"),e.classList.remove("flex");const r=e.querySelector("form");if(r&&r.reset(),t==="new-sale-modal"){const a=document.getElementById("sale-total-amount"),n=document.getElementById("sale-debt-display");a&&(a.textContent=u(0)),n&&(n.textContent=u(0));const o=document.getElementById("subproduct-select");o&&(o.innerHTML='<option value="" data-price="0" disabled selected>Seleccione Principal primero</option>',o.disabled=!0);const l=document.getElementById("main-product-select");l&&l.removeEventListener("change",Y)}}}function u(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)}async function P(){const t=document.getElementById("main-app-content"),e=document.getElementById("auth-container");if(!i||!t||!e){e&&(e.style.display="flex");return}const{data:{session:r},error:a}=await i.auth.getSession();a||!r?(e.style.display="flex",t.style.display="none"):(e.style.display="none",t.style.display="block",w())}async function Q(t){t.preventDefault();const e=document.getElementById("email").value,r=document.getElementById("password").value,{error:a}=await i.auth.signInWithPassword({email:e,password:r});a?alert(a.message):P()}async function W(){const{error:t}=await i.auth.signOut();t&&console.error("Error al cerrar sesi칩n:",t),P()}async function w(){await ee(),await te(),await ne()}async function ee(){const t=document.getElementById("total-clients"),e=document.getElementById("total-sales"),r=document.getElementById("total-debt");if(!t||!e||!r)return;const{count:a,error:n}=await i.from("clientes").select("client_id",{count:"exact",head:!0});n?t.textContent="Error":t.textContent=a,e.textContent=u(0),r.textContent=u(0);const{data:o,error:l}=await i.from("ventas").select("total_amount, paid_amount");if(l){console.error("Error al cargar ventas para totales:",l),e.textContent="Error",r.textContent="Error";return}let c=0,d=0;o&&o.length>0&&(c=o.reduce((m,p)=>m+(parseFloat(p.total_amount)||0),0),d=o.reduce((m,p)=>m+(parseFloat(p.paid_amount)||0),0));const s=c-d;e.textContent=u(c),r.textContent=u(s)}async function te(){const t=document.getElementById("debts-table-body");if(!t)return;t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">Cargando deudas...</td></tr>';const{data:e,error:r}=await i.from("ventas").select(`
            venta_id, 
            total_amount, 
            paid_amount,
            created_at,
clientes!ventas_client_id_fkey (name)
        `).order("created_at",{ascending:!1});if(r){console.error("Error al cargar ventas:",r),t.innerHTML=`<tr><td colspan="4" class="p-3 text-center text-red-500">Error: ${r.message}.</td></tr>`;return}const a=e.filter(n=>{const o=parseFloat(n.total_amount)||0,l=parseFloat(n.paid_amount)||0;return o>l});if(a.length===0){t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">No hay deudas pendientes.</td></tr>';return}t.innerHTML=a.map(n=>{var m;const o=parseFloat(n.total_amount)||0,l=parseFloat(n.paid_amount)||0,c=o-l,d=((m=n["clientes!ventas_client_id_fkey"])==null?void 0:m.name)||"Cliente Desconocido",s=new Date(n.created_at).toLocaleDateString();return`
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">${d} (Venta #${n.venta_id})</td>
                <td class="px-6 py-4 whitespace-nowrap text-red-600 font-bold">${u(c)}</td>
                <td class="px-6 py-4 whitespace-nowrap">${s}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <button class="text-indigo-600 hover:text-indigo-800 text-sm pay-debt-btn" data-sale-id="${n.venta_id}">
                        Pagar
                    </button>
                </td>
            </tr>
        `}).join(""),document.querySelectorAll(".pay-debt-btn").forEach(n=>{n.addEventListener("click",o=>{const l=o.currentTarget.dataset.saleId;ue(l)})})}async function ne(){const t=document.getElementById("clients-table-body");if(!t)return;const{data:e,error:r}=await i.from("clientes").select("client_id, name, contact").order("name",{ascending:!0});if(r){t.innerHTML=`<tr><td colspan="3" class="p-3 text-center text-red-500">Error al cargar clientes: ${r.message}</td></tr>`;return}if(e.length===0){t.innerHTML='<tr><td colspan="3" class="p-3 text-center text-gray-500">No hay clientes registrados.</td></tr>';return}t.innerHTML=e.map(a=>`
        <tr>
            <td class="px-6 py-4 whitespace-nowrap font-medium">${a.name}</td>
            <td class="px-6 py-4 whitespace-nowrap">${a.contact||"N/A"}</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <button class="text-indigo-600 hover:text-indigo-800 text-sm view-client-btn" data-client-id="${a.client_id}">
                    Ver Deuda
                </button>
            </td>
        </tr>
    `).join("")}async function ae(t){const e=document.getElementById(t);if(!e)return;if(e.innerHTML='<option value="" disabled selected>Cargando Principales...</option>',e.disabled=!0,g.length===0)try{await $()}catch{e.innerHTML='<option value="" disabled selected>Error al cargar Principales</option>';return}const r=g.filter(a=>a.type==="MAIN");e.innerHTML='<option value="null" selected>Ninguno (Producto Principal)</option>',e.disabled=!1,r.forEach(a=>{const n=document.createElement("option");n.value=a.name,n.textContent=a.name,e.appendChild(n)})}async function x(){const t=document.getElementById("sale-client-select");if(!t)return;t.innerHTML='<option value="" disabled selected>Cargando clientes...</option>';const{data:e,error:r}=await i.from("clientes").select("client_id, name").eq("is_active",!0).order("name",{ascending:!0});if(r)throw console.error("Error al cargar clientes:",r),t.innerHTML='<option value="" disabled selected>Error al cargar clientes</option>',new Error(`Fallo la carga de clientes: ${r.message}`);t.innerHTML='<option value="" disabled selected>Seleccione un cliente</option>',e.forEach(a=>{const n=document.createElement("option");n.value=a.client_id,n.textContent=a.name,t.appendChild(n)})}async function $(){if(g.length>0)return;const{data:t,error:e}=await i.from("productos").select("producto_id, name, price, type, parent_product").order("name",{ascending:!0});if(e)throw console.error("Error al cargar productos para select:",e),new Error("Fallo la carga de productos/paquetes");g=t}function S(){const t=document.getElementById("new-product-type"),e=document.getElementById("parent-product-container");!t||!e||(t.value==="PACKAGE"?e.style.display="block":(e.style.display="none",document.getElementById("new-product-parent-select").value="null"))}function re(t){const e=document.getElementById("subproduct-select");if(!e)return;e.innerHTML="",e.disabled=!1;const r=g.filter(n=>n.type==="PACKAGE"&&n.parent_product===t);if(r.length===0){const n=document.createElement("option");n.value="",n.textContent="No hay Paquetes/Subcategor칤as disponibles",n.disabled=!0,e.appendChild(n),e.disabled=!0;return}const a=document.createElement("option");a.value="",a.textContent="Seleccione Paquete/Subcategor칤a",a.disabled=!0,a.selected=!0,e.appendChild(a),r.forEach(n=>{const o=document.createElement("option");o.value=n.name,o.setAttribute("data-price",n.price),o.textContent=`${n.name} ($${n.price.toFixed(2)})`,e.appendChild(o)})}async function B(){const t=document.getElementById("admin-clients-table-body");if(!t)return;t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">Cargando clientes...</td></tr>';const{data:e,error:r}=await i.from("clientes").select("*").order("name",{ascending:!0});if(r){console.error("Error al cargar clientes:",r),t.innerHTML=`<tr><td colspan="4" class="p-3 text-center text-red-500">Error: ${r.message}</td></tr>`;return}if(e.length===0){t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">No hay clientes registrados.</td></tr>';return}t.innerHTML=e.map(a=>{const n=a.is_active?"Activo":"Inactivo",o=a.is_active?"text-green-600":"text-red-600",l=a.is_active?"Inhabilitar":"Habilitar",c=a.is_active?"text-red-600 hover:text-red-800":"text-green-600 hover:text-green-800",d=`
            <button class="text-gray-400 hover:text-red-500 text-sm delete-client-perm-btn ml-3" 
                    data-client-id="${a.client_id}" 
                    data-client-name="${a.name}">
                <i class="fas fa-trash"></i> Borrar Definitivo
            </button>
        `;return`
            <tr>
                <td class="px-6 py-4 whitespace-nowrap font-medium">${a.name}</td>
                <td class="px-6 py-4 whitespace-nowrap">${a.phone||"N/A"}</td>
                <td class="px-6 py-4 whitespace-nowrap"><span class="${o} font-semibold">${n}</span></td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <button class="text-indigo-600 hover:text-indigo-800 text-sm edit-client-btn" data-client-id="${a.client_id}">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="${c} text-sm toggle-active-btn ml-3" data-client-id="${a.client_id}" data-is-active="${a.is_active}">
                        <i class="fas fa-toggle-on"></i> ${l}
                    </button>
                    ${d} 
                </td>
            </tr>
        `}).join(""),document.querySelectorAll(".edit-client-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.currentTarget.dataset.clientId;ce(o)})}),document.querySelectorAll(".toggle-active-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.currentTarget.dataset.clientId,l=n.currentTarget.dataset.isActive==="true";ye(o,l)})}),document.querySelectorAll(".delete-client-perm-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.currentTarget.dataset.clientId,l=n.currentTarget.dataset.clientName;oe(o,l)})})}async function oe(t,e){if(t&&confirm(`游뚿 ALERTA CR칈TICA: 쮼st치s SEGURO de que deseas eliminar permanentemente a ${e} Y TODO SU HISTORIAL? Esta acci칩n es IRREVERSIBLE y se realizar치 de forma at칩mica.`))try{const{error:r}=await i.rpc("delete_client_cascade",{client_id_to_delete:t});if(r)throw r;alert(`Cliente ${e} y todo su historial financiero fueron eliminados permanentemente.`),B(),x(),w()}catch(r){console.error("Error al ejecutar el borrado RPC en cascada:",r),alert(`Fallo la eliminaci칩n total del cliente. Error: ${r.message}`)}}async function A(){const t=document.getElementById("admin-products-table-body");if(!t)return;t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">Cargando productos...</td></tr>';const{data:e,error:r}=await i.from("productos").select("*").order("type",{ascending:!1}).order("name",{ascending:!0});if(r){console.error("Error al cargar productos para la tabla:",r),t.innerHTML=`<tr><td colspan="4" class="p-3 text-center text-red-500">Error al cargar productos: ${r.message}</td></tr>`;return}if(e.length===0){t.innerHTML='<tr><td colspan="4" class="p-3 text-center text-gray-500">No hay productos o paquetes registrados.</td></tr>';return}t.innerHTML=e.map(a=>`
        <tr>
            <td class="px-6 py-4 whitespace-nowrap font-medium">${a.name}</td>
            <td class="px-6 py-4 whitespace-nowrap">${a.type==="MAIN"?"Principal":"Paquete"}</td>
            <td class="px-6 py-4 whitespace-nowrap">${u(a.price)}</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <button class="text-indigo-600 hover:text-indigo-800 text-sm edit-product-btn" data-product-id="${a.producto_id}">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button class="text-red-600 hover:text-red-800 text-sm delete-product-btn ml-3" data-product-id="${a.producto_id}">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </td>
        </tr>
    `).join(""),document.querySelectorAll(".delete-product-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.currentTarget.dataset.productId;de(o)})})}async function le(t){t.preventDefault();const e=document.getElementById("new-client-name").value.trim(),r=document.getElementById("new-client-phone").value.trim();if(!e){alert("El nombre del cliente es obligatorio.");return}try{const{error:a}=await i.from("clientes").insert([{name:e,contact:r||null}]);if(a)throw a;alert("Cliente registrado exitosamente!"),f("new-client-modal"),w()}catch(a){console.error("Error al registrar cliente:",a),alert(`Fallo el registro del cliente. Error: ${a.message}`)}}async function ce(t){if(!t)return;const{data:e,error:r}=await i.from("clientes").select("*").eq("client_id",t).single();if(r){console.error("Error al cargar cliente para edici칩n:",r),alert(`Error al cargar cliente: ${r.message}`);return}document.getElementById("edit-client-id").value=e.client_id,document.getElementById("edit-client-name").value=e.name,document.getElementById("edit-client-phone").value=e.phone||"",document.getElementById("edit-client-modal-title").textContent=`Editar Cliente: ${e.name}`,v("edit-client-modal")}async function ie(t){t.preventDefault();const e=document.getElementById("edit-client-id").value,r=document.getElementById("edit-client-name").value.trim(),a=document.getElementById("edit-client-phone").value.trim();if(!e||!r){alert("Nombre del cliente es obligatorio.");return}try{const{error:n}=await i.from("clientes").update({name:r,phone:a||null}).eq("client_id",e);if(n)throw n;alert(`춰Cliente ${r} actualizado exitosamente!`),f("edit-client-modal"),B(),x()}catch(n){console.error("Error al editar cliente:",n),alert(`Fallo la edici칩n del cliente. Error: ${n.message}`)}}async function de(t){if(t&&confirm("쮼st치s seguro de que deseas eliminar este producto? Esta acci칩n es irreversible y podr칤a afectar ventas hist칩ricas."))try{const{error:e}=await i.from("productos").delete().eq("producto_id",t);if(e)throw e;alert("Producto eliminado exitosamente."),A()}catch(e){console.error("Error al eliminar producto:",e),alert(`Fallo la eliminaci칩n del producto. Error: ${e.message}`)}}async function se(t){var c;t.preventDefault();const e=document.getElementById("new-product-name").value.trim(),r=parseFloat(document.getElementById("new-product-price").value),a=document.getElementById("new-product-type").value,n=document.getElementById("new-product-description").value.trim(),o=(c=document.getElementById("new-product-parent-select"))==null?void 0:c.value;let l=null;if(a==="PACKAGE"&&o&&o!=="null"&&(l=o),!e||isNaN(r)||r<0){alert("Nombre y Precio Base son obligatorios.");return}if(a==="PACKAGE"&&l===null){alert("Por favor, selecciona un Producto Principal (Padre) para este Paquete.");return}try{const{error:d}=await i.from("productos").insert([{name:e,price:r,type:a,description:n||null,parent_product:l}]);if(d)throw d;alert(`춰${e} registrado exitosamente!`);const s=document.getElementById("modal-title-product");s&&(s.textContent="Registrar Nuevo Producto"),f("new-product-modal"),A(),g=[]}catch(d){console.error("Error al registrar producto:",d),alert(`Fallo el registro del producto. Error: ${d.message}`)}}async function ue(t){var c;if(!t)return;const{data:e,error:r}=await i.from("ventas").select(`
            total_amount, 
            paid_amount,
            client_id,
            ventas_client_id_fkey (name) 
        `).eq("venta_id",t).single();if(r||!e){console.error("Error al cargar datos de venta para pago:",r),alert("No se pudo cargar la informaci칩n de la deuda.");return}const a=parseFloat(e.total_amount)||0,n=parseFloat(e.paid_amount)||0,o=a-n;if(o<=0){alert("Esta venta ya no tiene deuda pendiente.");return}document.getElementById("payment-venta-id").value=t,document.getElementById("payment-client-id").value=e.client_id,document.getElementById("payment-client-name").textContent=((c=e.ventas_client_id_fkey)==null?void 0:c.name)||"Cliente Desconocido",document.getElementById("payment-current-debt").textContent=u(o);const l=document.getElementById("payment-amount");l.setAttribute("max",o.toFixed(2)),l.value=o.toFixed(2),v("payment-modal")}async function me(t){t.preventDefault();const e=document.getElementById("payment-venta-id").value,r=document.getElementById("payment-client-id").value,a=parseFloat(document.getElementById("payment-amount").value),n=document.getElementById("payment-method").value,o=document.getElementById("payment-current-debt").textContent;if(!e||!r||a<=0){alert("Datos incompletos o monto inv치lido.");return}const{data:l,error:c}=await i.from("ventas").select("total_amount, paid_amount").eq("venta_id",e).single();if(c){console.error("Error al obtener venta para actualizar:",c),alert("Error al obtener datos de venta.");return}const d=parseFloat(l.total_amount)||0,s=parseFloat(l.paid_amount)||0,m=d-s;if(a>m){alert(`El monto del abono (${u(a)}) supera la deuda pendiente (${o}).`);return}const p=s+a;try{const{error:y}=await i.from("pagos").insert([{venta_id:e,client_id:r,amount:a,metodo_pago:n}]);if(y)throw y;const{error:_}=await i.from("ventas").update({paid_amount:p}).eq("venta_id",e);if(_)throw _;alert(`춰Abono de ${u(a)} registrado exitosamente!`),f("payment-modal"),w()}catch(y){console.error("Error al registrar abono:",y),alert(`Fallo el registro del abono. Error: ${y.message}`)}}async function pe(t){t.preventDefault();const e=t.target,r=e.querySelector("#sale-client-select").value,a=parseFloat(e.querySelector("#sale-payment-amount").value)||0,n=e.querySelector("#sale-payment-method").value;if(!r){alert("Por favor, selecciona un cliente.");return}const o=[];let l=0;const c=e.querySelector("#subproduct-select"),d=e.querySelector("#sale-quantity"),s=e.querySelector("#sale-price"),m=c==null?void 0:c.value,p=parseFloat(d==null?void 0:d.value)||0,y=parseFloat(s==null?void 0:s.value)||0;if(m&&p>0&&y>=0&&(o.push({producto_id:m,quantity:p,price_at_sale:y}),l=p*y),o.length===0){alert("Por favor, selecciona un Paquete/Subcategor칤a v치lido, cantidad y precio.");return}if(a>l){alert("El monto pagado no puede ser mayor que el total de la venta.");return}const _=l,L=a;try{const{data:I,error:b}=await i.from("ventas").insert([{client_id:r,total_amount:_,paid_amount:L}]).select("venta_id").single();if(b||!I){console.error("Error al insertar venta:",b),alert(`Error al registrar la venta: ${(b==null?void 0:b.message)||"Desconocido"}`);return}const F=I.venta_id,V=o.map(E=>({venta_id:F,producto_id:E.producto_id,quantity:E.quantity,price_at_sale:E.price_at_sale})),{error:C}=await i.from("ventas_productos").insert(V);if(C){console.error("Error al insertar detalles de venta:",C),alert(`Error al registrar el detalle de la venta: ${C.message}`);return}if(L>0){const{error:E}=await i.from("pagos").insert([{venta_id:F,amount:L,client_id:r,metodo_pago:n}]);E&&(console.error("Error al registrar pago inicial:",E),alert(`Error al registrar el pago inicial: ${E.message}`))}alert("Venta registrada exitosamente. Deuda calculada."),f("new-sale-modal"),await w()}catch(I){console.error("Error general en la venta:",I),alert("Ocurri칩 un error inesperado al registrar la venta.")}}async function ye(t,e){if(!t)return;const r=!e,a=r?"habilitar":"inhabilitar";if(confirm(`쮼st치s seguro de que deseas ${a} a este cliente?`))try{const{error:n}=await i.from("clientes").update({is_active:r}).eq("client_id",t);if(n)throw n;alert(`Cliente ${r?"habilitado":"inhabilitado"} exitosamente.`),B(),x()}catch(n){console.error(`Error al ${a} cliente:`,n),alert(`Fallo al ${a} cliente. Error: ${n.message}`)}}function Y(){const t=document.getElementById("main-product-select"),e=document.getElementById("subproduct-select"),r=document.getElementById("sale-price");if(!t||!e||!r)return;const a=t.options[t.selectedIndex].textContent;e.innerHTML='<option value="" data-price="0" disabled selected>Cargando opciones...</option>',e.disabled=!0,r.value="0.00";let n=[],o=null;if(n=g.filter(l=>l.type==="PACKAGE"&&l.parent_product===a),o=g.find(l=>l.name===a&&l.type==="MAIN"),n.length>0&&(e.innerHTML='<option value="" data-price="0" disabled selected>Seleccione un Paquete</option>',n.forEach(l=>{const c=document.createElement("option");c.value=l.producto_id,c.textContent=`${l.name} (Paquete) - ${u(l.price)}`,c.dataset.price=l.price,e.appendChild(c)})),o){const l=document.createElement("option");l.value=o.producto_id,l.textContent=`[Precio Base] - ${u(o.price)}`,l.dataset.price=o.price,e.appendChild(l),n.length===0&&(e.value=o.producto_id)}e.disabled=!1,h()}function h(){const t=document.getElementById("subproduct-select"),e=document.getElementById("sale-quantity"),r=document.getElementById("sale-price"),a=document.getElementById("sale-total-amount"),n=document.getElementById("sale-debt-display"),o=document.getElementById("sale-payment-amount");let l=0;const c=parseFloat(e==null?void 0:e.value)||0;let d=parseFloat(r==null?void 0:r.value)||0;const s=parseFloat(o==null?void 0:o.value)||0;if(t!=null&&t.value&&c>0){if(d===0||r.value.trim()===""){const p=t.selectedOptions[0];d=parseFloat(p==null?void 0:p.dataset.price)||0,d>=0&&(r.value=d.toFixed(2))}l=c*d}const m=Math.max(0,l-s);a&&(a.textContent=u(l)),n&&(n.textContent=u(m))}var M;(M=document.getElementById("new-product-type"))==null||M.addEventListener("change",S);var T;(T=document.getElementById("login-form"))==null||T.addEventListener("submit",Q);var q;(q=document.getElementById("logout-button"))==null||q.addEventListener("click",W);var D;(D=document.getElementById("edit-client-form"))==null||D.addEventListener("submit",ie);var N;(N=document.getElementById("new-sale-form"))==null||N.addEventListener("submit",pe);var H;(H=document.getElementById("new-client-form"))==null||H.addEventListener("submit",le);var O;(O=document.getElementById("new-product-form"))==null||O.addEventListener("submit",se);var k;(k=document.getElementById("payment-form"))==null||k.addEventListener("submit",me);var R;(R=document.getElementById("open-new-sale-modal"))==null||R.addEventListener("click",async()=>{var t,e,r,a;try{await x(),await $();const n=document.getElementById("main-product-select");n.innerHTML='<option value="" disabled selected>Seleccione Producto Principal</option>',g.filter(o=>o.type==="MAIN").forEach(o=>{const l=document.createElement("option");l.textContent=o.name,n.appendChild(l)}),n.addEventListener("change",Y),(t=document.getElementById("subproduct-select"))==null||t.addEventListener("change",h),(e=document.getElementById("sale-quantity"))==null||e.addEventListener("input",h),(r=document.getElementById("sale-price"))==null||r.addEventListener("input",h),(a=document.getElementById("sale-payment-amount"))==null||a.addEventListener("input",h),h(),v("new-sale-modal")}catch(n){console.error("Error al cargar datos de selects:",n),alert("Error al cargar los datos de clientes/productos. Revise la consola (F12).")}});var U;(U=document.getElementById("open-admin-products-modal"))==null||U.addEventListener("click",async t=>{t.preventDefault();try{await A(),v("admin-products-modal")}catch(e){console.error("Error al cargar la lista de productos:",e),alert("Error al cargar los productos. Revise la consola para detalles.")}});var j;(j=document.getElementById("open-new-client-modal"))==null||j.addEventListener("click",()=>{v("new-client-modal")});var z;(z=document.getElementById("open-new-product-modal"))==null||z.addEventListener("click",async()=>{await $(),await ae("new-product-parent-select"),S(),v("new-product-modal")});var K;(K=document.getElementById("open-admin-clients-modal"))==null||K.addEventListener("click",async t=>{t.preventDefault(),await B(),v("admin-clients-modal")});var G;(G=document.getElementById("main-product-select"))==null||G.addEventListener("change",t=>{const e=t.target.value;re(e)});var J;(J=document.getElementById("new-product-type"))==null||J.addEventListener("change",S);document.querySelectorAll("[data-close-modal]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const r=t.getAttribute("data-close-modal");f(r)})});document.addEventListener("click",t=>{document.querySelectorAll(".modal-overlay:not(.hidden)").forEach(r=>{t.target===r&&f(r.id)})});document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.querySelectorAll(".modal-overlay:not(.hidden)"),r=e[e.length-1];r&&f(r.id)}});P();
