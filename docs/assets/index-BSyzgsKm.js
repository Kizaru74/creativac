(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const re="https://wnwftbamyaotqdsivmas.supabase.co",de="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indud2Z0YmFteWFvdHFkc2l2bWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1OTY0OTcsImV4cCI6MjA3OTE3MjQ5N30.r8Fh7FUYOnUQHboqfKI1eb_37NLuAn3gRLbH8qUPpMo";let u,w=[],x=[],S=null,A=[],le={};window.supabase?u=window.supabase.createClient(re,de):(console.error("Error Fatal: Librería Supabase no encontrada. La aplicación no funcionará."),u=null);function E(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)}function P(t){const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(t).toLocaleDateString("es-MX",e)}function ye(t){if(!t)return{start:null,end:null};const[e,n]=t.split("-").map(Number),o=new Date(e,n-1,1),a=new Date(e,n,1),r=o.toISOString().substring(0,10),d=a.toISOString().substring(0,10);return{start:r,end:d}}window.openModal=function(t){const e=document.getElementById(t);e&&(e.classList.add("flex"),e.classList.remove("hidden"))};window.closeModal=function(t){const e=document.getElementById(t);e&&(e.classList.add("hidden"),e.classList.remove("flex"))};async function z(){const{data:{user:t}}=await u.auth.getUser(),e=document.getElementById("auth-container"),n=document.getElementById("dashboard-container");if(!e||!n){console.error("Error: Los contenedores 'auth-container' o 'dashboard-container' no se encontraron en el HTML.");return}t?(e.classList.add("hidden"),n.classList.remove("hidden"),await M()):(e.classList.remove("hidden"),n.classList.add("hidden"))}async function fe(t){t.preventDefault();const e=document.getElementById("email").value,n=document.getElementById("password").value,{error:o}=await u.auth.signInWithPassword({email:e,password:n});o?alert(o.message):z()}async function Ee(){await u.auth.signOut(),z()}async function ve(){const t=document.getElementById("sales-month-filter"),e=document.getElementById("filter-status"),n=t==null?void 0:t.value,{start:o,end:a}=ye(n);let r=u.from("ventas").select("total_amount"),d="Total histórico";o&&a&&(r=r.gte("created_at",o).lt("created_at",a),d=`Total del mes de ${new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"long"})}`);const{data:l,error:c}=await r;if(c){console.error("Error al cargar ventas:",c),document.getElementById("total-sales").textContent=E(0),e&&(e.textContent="Error al cargar");return}const i=l.reduce((y,f)=>y+f.total_amount,0);document.getElementById("total-sales").textContent=E(i),e&&(e.textContent=d);const{data:p,error:g}=await u.from("ventas").select("saldo_pendiente").gt("saldo_pendiente",0);if(g){console.error("Error al cargar deudas:",g),document.getElementById("total-debt").textContent=E(0);return}const m=p.reduce((y,f)=>y+f.saldo_pendiente,0);document.getElementById("total-debt").textContent=E(m)}async function he(){try{const{data:t,error:e}=await u.from("ventas").select("venta_id, created_at, total_amount, saldo_pendiente, clientes(name, client_id)").gt("saldo_pendiente",.01).order("created_at",{ascending:!1}).limit(5);if(e){console.error("Error al cargar tabla de deudas:",e);return}const n=document.getElementById("debt-sales-body");if(!n)return;n.innerHTML="";const o=document.getElementById("no-debt-message");if(o&&o.classList.add("hidden"),t.length===0){o&&o.classList.remove("hidden");return}t.forEach(a=>{var c,i;const r=((c=a.clientes)==null?void 0:c.name)||"Cliente Desconocido",d=(i=a.clientes)==null?void 0:i.client_id,l=document.createElement("tr");l.className="hover:bg-gray-50",l.innerHTML=`
                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${a.venta_id}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${r}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-red-600">${E(a.saldo_pendiente)}</td>
                <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button 
                        type="button" 
                        class="view-debt-btn" 
                        data-client-id="${d}" 
                        data-sale-id="${a.venta_id}" // Si necesitas la venta, mantenla
        class="view-debt-btn bg-red-600 hover:bg-red-700 text-white font-semibold text-xs py-1 px-2 rounded"
                    >
                        Detalles/Pagar
                    </button>
                </td>
            `,n.appendChild(l)}),n.querySelectorAll(".view-debt-btn").forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.clientId;N(r)})})}catch(t){console.error("Error inesperado en loadDebts:",t)}}async function be(){try{const{data:t,error:e}=await u.from("ventas").select("venta_id, created_at, total_amount, saldo_pendiente, clientes(name, client_id), description").order("created_at",{ascending:!1}).limit(7);if(e){console.error("Error al cargar ventas recientes:",e);return}const n=document.getElementById("recent-sales-body"),o=document.getElementById("no-sales-message");if(!n)return;if(n.innerHTML="",o&&o.classList.add("hidden"),t.length===0){o&&o.classList.remove("hidden");return}t.forEach(a=>{var c,i;const r=((c=a.clientes)==null?void 0:c.name)||"Cliente Desconocido",d=(i=a.clientes)==null?void 0:i.client_id,l=document.createElement("tr");l.className="hover:bg-gray-50",l.innerHTML=`
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${a.venta_id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${r}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${P(a.created_at)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">${E(a.total_amount)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold ${a.saldo_pendiente>0?"text-red-600":"text-green-600"}">${E(a.saldo_pendiente)}</td>
                
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"> 
                    <button type="button" 
                            class="view-sale-details-btn text-indigo-600 hover:text-indigo-900 font-semibold text-xs py-1 px-2 rounded bg-indigo-100"
                            data-sale-id="${a.venta_id}"
                            data-client-id="${d}"> 
                        Detalles
                    </button>
                </td>
            `,n.appendChild(l)}),n.querySelectorAll(".view-sale-details-btn").forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.saleId,d=a.dataset.clientId;se(r,d)})})}catch(t){console.error("Error inesperado en loadRecentSales:",t)}}async function M(){await ve(),await he(),await be(),await $("gestion"),await B(),await $e(),await ie()}async function ie(){const t=document.getElementById("client-select");if(!t)return;t.innerHTML='<option value="" disabled selected>Cargando clientes...</option>';const{data:e,error:n}=await u.from("clientes").select("client_id, name").order("name",{ascending:!0});if(n){console.error("Error al cargar clientes para venta:",n),t.innerHTML='<option value="" disabled selected>Error al cargar (revisar consola)</option>';return}if(e.length===0){t.innerHTML='<option value="" disabled selected>No hay clientes activos</option>';return}t.innerHTML='<option value="" disabled selected>Seleccione un Cliente</option>',e.forEach(o=>{const a=document.createElement("option");a.value=o.client_id,a.textContent=o.name,t.appendChild(a)})}async function B(){if(!u){console.warn("Supabase no inicializado. No se pudieron cargar los productos.");return}const{data:t,error:e}=await u.from("productos").select("producto_id, name, type, price, parent_product");if(e){console.error("Error al cargar todos los productos:",e),w=[];return}w=t||[]}function we(){const t=document.getElementById("product-main-select"),e=document.getElementById("subproduct-select"),n=document.getElementById("product-unit-price");if(!t||!e||!n||typeof w>"u")return;const o=t.value;if(e.innerHTML='<option value="" selected>Sin Paquete</option>',e.disabled=!0,n.value="0.00",!o)return;if(!w.find(d=>String(d.producto_id)===String(o))){console.warn(`Producto principal con ID ${o} no encontrado.`);return}R(o);const r=w.filter(d=>d.type&&d.type.trim().toUpperCase()==="PACKAGE"&&d.parent_product&&String(d.parent_product)===String(o));r.length>0&&(e.disabled=!1,e.innerHTML='<option value="" disabled selected>Seleccione un Paquete</option>',r.forEach(d=>{const l=document.createElement("option");l.value=d.producto_id;const c=typeof E=="function"?E(d.price):`$${d.price.toFixed(2)}`;l.textContent=`${d.name} (${c})`,e.appendChild(l)}))}async function H(){const t=document.getElementById("product-main-select"),e=document.getElementById("subproduct-select"),n=document.getElementById("product-unit-price");if(!t||!e||!n)return;const o=w.filter(a=>a.type&&a.type.trim().toUpperCase()==="MAIN");if(e.innerHTML='<option value="" selected>Sin Paquete</option>',n.value="0.00",e.disabled=!0,o.length===0){t.innerHTML='<option value="" disabled selected>❌ No hay Productos Base (Tipo: MAIN)</option>';return}t.innerHTML='<option value="" disabled selected>Seleccione Producto Base</option>',o.forEach(a=>{const r=document.createElement("option");r.value=a.producto_id,r.textContent=`${a.name}`,t.appendChild(r)})}async function ce(t){const e=document.getElementById(t);if(!e)return;const n=w.filter(o=>o.type&&o.type.trim().toUpperCase()==="MAIN");if(e.innerHTML='<option value="" disabled selected>Seleccione Producto Principal</option>',n.length===0){e.innerHTML='<option value="" disabled selected>❌ No hay Productos Base (Tipo: MAIN)</option>';return}n.forEach(o=>{const a=document.createElement("option");a.value=o.producto_id,a.textContent=`${o.name} ($${o.price.toFixed(2)})`,e.appendChild(a)})}function R(t){const e=document.getElementById("product-unit-price"),n=w.find(o=>String(o.producto_id)===String(t));e&&(n&&n.price!==void 0?e.value=n.price.toFixed(2):e.value="0.00")}function ee(){const t=x.reduce((o,a)=>o+a.subtotal,0),e=document.getElementById("total-amount");e&&(e.value=t.toFixed(2)),k(t);const n=document.getElementById("submit-sale-btn");return x.length>0?n==null||n.removeAttribute("disabled"):n==null||n.setAttribute("disabled","true"),t}function T(){const t=document.getElementById("sale-items-container");if(t){if(t.innerHTML="",x.length===0){t.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">Agrega productos a la venta.</td></tr>',ee();return}x.forEach((e,n)=>{const o=document.createElement("tr");o.className="hover:bg-gray-50",o.innerHTML=`
            <td class="px-6 py-3 text-sm font-medium text-gray-900">${e.name}</td>
            <td class="px-6 py-3 text-sm text-gray-500">${E(e.price)}</td>
            <td class="px-6 py-3 text-sm text-gray-500 text-center">${e.quantity}</td>
            <td class="px-6 py-3 text-sm font-bold">${E(e.subtotal)}</td>
            <td class="px-6 py-3 text-right text-sm font-medium">
                <button type="button" onclick="removeItemFromSale(${n})" 
                        class="text-red-600 hover:text-red-900">
                    <i class="fas fa-times-circle"></i>
                </button>
            </td>
        `,t.appendChild(o)}),ee()}}window.removeItemFromSale=function(t){x.splice(t,1),T()};function xe(t){t.preventDefault();const e=document.getElementById("product-main-select"),n=document.getElementById("subproduct-select"),o=document.getElementById("product-quantity"),a=e==null?void 0:e.value,r=n==null?void 0:n.value,d=parseFloat(o==null?void 0:o.value);let l=r;l||(l=a);const c=String(l),i=w.find(v=>String(v.producto_id)===c);if(!i){alert("Por favor, selecciona un Producto o Paquete válido.");return}if(isNaN(d)||d<=0){alert("La cantidad debe ser mayor a cero.");return}let p=i.name;if(r){const v=w.find(I=>String(I.producto_id)===String(a));v&&(p=`${v.name} (${i.name})`)}const g=i.price,m=d*g,y={product_id:c,name:p,quantity:d,price:g,subtotal:m},f=x.findIndex(v=>v.product_id===c);f>-1?(x[f].quantity+=d,x[f].subtotal+=m):x.push(y),T(),e.value="",n.value="",o.value="1",R(null),H()}async function Ie(t,e,n,o){if(!u||isNaN(o)||o<=0){alert("El precio debe ser un monto positivo.");return}try{const{data:a,error:r}=await u.from("detalle_ventas").select("quantity").eq("id",e).single();if(r||!a)throw new Error("No se pudo obtener el detalle del ítem.");const l=a.quantity*o,{error:c}=await u.from("detalle_ventas").update({price:o,subtotal:l}).eq("id",e);if(c)throw c;const{data:i,error:p}=await u.from("detalle_ventas").select("subtotal").eq("venta_id",t);if(p||!i)throw p;const g=i.reduce((f,v)=>f+v.subtotal,0),m=g,{error:y}=await u.from("ventas").update({total_amount:g,saldo_pendiente:m}).eq("venta_id",t);if(y)throw y;alert(`✅ Deuda de ${E(m)} registrada exitosamente.`),await $("gestion"),await N(n)}catch(a){console.error("Error al actualizar precio post-venta:",a),alert(`Error al actualizar la venta: ${a.message}`)}}function k(t=null){const e=document.getElementById("paid-amount"),n=document.getElementById("payment-method"),o=document.getElementById("total-amount"),a=t||parseFloat(o==null?void 0:o.value)||0,r=n==null?void 0:n.value;let d=parseFloat(e==null?void 0:e.value)||0;r==="Deuda"?(d=0,e&&(e.value="0.00",e.readOnly=!0)):(e&&(e.readOnly=!1),d>a&&(d=a,e&&(e.value=a.toFixed(2))));const l=Math.max(0,a-d),c=document.getElementById("remaining-balance");c&&(c.value=l.toFixed(2)),e&&r!=="Deuda"&&e.setAttribute("max",a.toFixed(2))}async function _e(t){if(!u)return{totalVentas:0,deudaNeta:0};try{const{data:e,error:n}=await u.from("transacciones_deuda").select("type, amount").eq("client_id",t);if(n)throw n;let o=0,a=0;return e.forEach(r=>{r.type==="cargo_venta"?(o+=r.amount,a+=r.amount):a-=r.amount}),a=Math.max(0,a),{totalVentas:o,deudaNeta:a}}catch(e){return console.error(`Error al obtener resumen del cliente ${t}:`,e),{totalVentas:0,deudaNeta:0}}}async function Be(t){if(t.preventDefault(),!u)return;const e=document.getElementById("abono-client-id-input"),n=document.getElementById("abono-amount"),o=document.getElementById("abono-method");if(!e||!n||!o){console.error("Error FATAL: No se encontraron los campos del formulario de abono. Revise los IDs en el HTML."),alert("Error interno: Faltan campos en el formulario. Contacte soporte.");return}const a=e.value,r=parseFloat(n.value),d=o.value;if(!a||r<=0){alert("Por favor, seleccione un cliente y un monto válido.");return}try{const{data:l,error:c}=await u.from("abonos").insert({client_id:a,fecha_abono:new Date().toISOString()}).select("abono_id").single();if(c)throw c;const i=l.abono_id,{error:p}=await u.from("pagos").insert({abono_id:i,amount:r,payment_method:d});if(p)throw p;alert("✅ Abono registrado exitosamente."),closeModal("modal-record-abono"),closeModal("modal-client-debt-report"),await $("gestion")}catch(l){console.error("Error al registrar abono:",l.message||l),alert("Hubo un error al registrar el abono. Intente nuevamente.")}}async function Le(t){var p,g,m,y;t.preventDefault();const e=((p=document.getElementById("client-select"))==null?void 0:p.value)??null,n=((g=document.getElementById("payment-method"))==null?void 0:g.value)??"Efectivo",o=((m=document.getElementById("sale-description"))==null?void 0:m.value.trim())??null,a=((y=document.getElementById("paid-amount"))==null?void 0:y.value)??"0";let r=parseFloat(a);const d=x.reduce((f,v)=>f+v.subtotal,0);n==="Deuda"&&(r=0);const l=d-r;if(!e){alert("Por favor, selecciona un cliente.");return}if(x.length===0){alert("Debes agregar al menos un producto a la venta.");return}if(d<0){alert("El total de la venta no puede ser negativo.");return}let c=r,i=l;if(d===0&&(c=0,i=0),n!=="Deuda"&&(c<0||c>d)){alert("El monto pagado es inválido.");return}if(!(i>.01&&n!=="Deuda"&&!confirm(`¡Atención! Hay un saldo pendiente de ${E(i)}. ¿Deseas continuar registrando esta cantidad como deuda?`)))try{const{data:f,error:v}=await u.from("ventas").insert([{client_id:e,total_amount:d,paid_amount:c,saldo_pendiente:i,metodo_pago:n,description:o}]).select("venta_id");if(v||!f||f.length===0){console.error("Error al insertar venta:",v),alert(`Error al registrar la venta: ${(v==null?void 0:v.message)||"Desconocido"}`);return}const I=f[0].venta_id,D=x.map(_=>({venta_id:I,product_id:_.product_id,name:_.name,quantity:_.quantity,price:_.price,subtotal:_.subtotal})),{error:L}=await u.from("detalle_ventas").insert(D);if(L&&(console.error("Error al insertar detalles de venta:",L),alert(`Venta registrada (ID: ${I}), pero falló el registro de detalles: ${L.message}`)),c>0){const{error:_}=await u.from("pagos").insert([{venta_id:I,amount:c,client_id:e,metodo_pago:n}]);_&&(console.error("Error al registrar pago inicial:",_),alert(`Advertencia: El pago inicial falló. ${_.message}`))}closeModal("new-sale-modal"),await M(),Fe(I)}catch(f){console.error("Error fatal al registrar la venta:",f.message),alert("Error fatal al registrar la venta: "+f.message)}finally{x=[],T(),document.getElementById("new-sale-form").reset()}}let V=null;async function N(t){if(!u){console.error("Supabase no está inicializado.");return}V=t;const e=A.find(n=>n.client_id.toString()===t.toString());if(!e){console.error("Cliente no encontrado en allClients.");return}try{const{data:n,error:o}=await u.from("transacciones_deuda").select(`
                transaction_id, created_at, type, amount, client_id
            `).eq("client_id",t).order("created_at",{ascending:!0});if(o)throw o;const a=document.getElementById("client-transactions-body"),r=document.getElementById("client-report-total-debt");if(!a||!r)return;let d=0,l="";n.forEach(i=>{const p=i.type==="cargo_venta";p?d+=i.amount:d-=i.amount;const g=d;let m="",y="";switch(i.type){case"cargo_venta":m="Venta (Cargo)",y="Venta que generó deuda.";break;case"abono_inicial":m="Pago Inicial",y="Pago realizado al momento de la venta.";break;case"abono_posterior":m="Abono",y="Pago posterior a la venta.";break;default:m="Movimiento",y="Movimiento de deuda."}let f="";const v=Math.abs(parseFloat(i.amount))<.01;i.type==="cargo_venta"&&v&&t&&(f=`
                    <button onclick="handleViewSaleDetails('${i.transaction_id}', '${t}')"
                            class="ml-2 px-2 py-1 text-xs text-white bg-yellow-500 rounded hover:bg-yellow-600 transition duration-150">
                        Añadir Precio
                    </button>
                 `),l+=`
                <tr>
                    <td class="px-3 py-2 text-sm">${P(i.created_at)}</td>
                    <td class="px-3 py-2 text-sm" title="${y}">${m} ${f}</td>
                    <td class="px-3 py-2 text-sm ${p?"text-red-600":"text-green-600"}">
                        ${E(i.amount)}
                    </td>
                    <td class="px-3 py-2 text-sm font-semibold">${E(g)}</td>
                </tr>
            `}),document.getElementById("client-report-name").textContent=e.name,a.innerHTML=l;const c=d;r.textContent=E(c),r.className=`font-bold ${c>0?"text-red-600":"text-green-600"}`,openModal("modal-client-debt-report")}catch(n){console.error("Error al cargar el reporte de deuda:",n),alert("Hubo un error al cargar el reporte de deuda del cliente.")}}async function se(t,e){if(!u){console.error("Supabase no está inicializado.");return}const n=A.find(o=>o.client_id.toString()===e.toString());if(!n){console.error("Cliente no encontrado en allClients."),alert("Error: Cliente no encontrado para esta venta.");return}V=e;try{const{data:o,error:a}=await u.from("ventas").select("venta_id, total_amount, saldo_pendiente, created_at, description, metodo_pago").eq("venta_id",t).single();if(a||!o){console.error("Error al cargar detalles de la venta (Tabla Ventas):",a),alert("Error: No se encontró la venta principal (ID: "+t+") en la tabla 'ventas'.");return}const{data:r,error:d}=await u.from("detalle_ventas").select("detalle_id, quantity, price, subtotal, productos(name)").eq("venta_id",t).order("detalle_id",{ascending:!0});if(d)throw d;const{data:l,error:c}=await u.from("pagos").select("amount, metodo_pago, created_at").eq("venta_id",t).order("created_at",{ascending:!0});if(c)throw c;document.getElementById("detail-sale-id").textContent=`#${o.venta_id}`,document.getElementById("detail-client-name").textContent=n.name,document.getElementById("detail-date").textContent=P(o.created_at),document.getElementById("detail-total-amount").textContent=E(o.total_amount),document.getElementById("detail-saldo-pendiente").textContent=E(o.saldo_pendiente),document.getElementById("detail-comments").textContent=o.description||"Sin comentarios.",document.getElementById("payment-sale-id").value=o.venta_id;const i=document.getElementById("detail-items-body");i.innerHTML="",(r||[]).forEach(y=>{var f;i.innerHTML+=`
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-3">${((f=y.productos)==null?void 0:f.name)||"Producto Desconocido"}</td>
                    <td class="px-6 py-3 text-center">${y.quantity}</td>
                    <td class="px-6 py-3 text-right">${E(y.price)}</td>
                    <td class="px-6 py-3 text-right">${E(y.subtotal)}</td>
                </tr>
            `});const p=document.getElementById("detail-payments-body");p.innerHTML="",l.length===0?p.innerHTML='<tr><td colspan="3" class="px-6 py-3 text-center text-gray-500 italic">No hay pagos registrados para esta venta.</td></tr>':l.forEach(y=>{p.innerHTML+=`
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-3">${P(y.created_at)}</td>
                        <td class="px-6 py-3 text-right font-semibold text-green-600">${E(y.amount)}</td>
                        <td class="px-6 py-3 text-center">${y.metodo_pago}</td>  
                    </tr>
                `});const g=document.getElementById("sale-edit-section");if(Math.abs(parseFloat(o.total_amount))<.01&&o.metodo_pago==="Deuda"&&r.length>0){g.classList.remove("hidden");const y=r[0];document.getElementById("sale-edit-transaction-id").value=`${o.venta_id}|${y.detalle_id}|${e}`,document.getElementById("sale-edit-price").value=y.price.toFixed(2)}else g.classList.add("hidden");openModal("modal-detail-sale")}catch(o){console.error("Error al cargar detalles de venta:",o),alert("Hubo un error al cargar los detalles de la venta.")}}async function $(t="gestion"){if(!u){console.error("Supabase no está inicializado.");return}const e=document.getElementById("clients-list-body");if(!e){console.error("Contenedor de clientes ('clients-list-body') no encontrado.");return}const n=t==="gestion";try{const{data:o,error:a}=await u.from("clientes").select("client_id, name, telefono").order("name",{ascending:!0});if(a)throw a;A=o;const r=o.map(l=>_e(l.client_id)),d=await Promise.all(r);e.innerHTML="",o.forEach((l,c)=>{const i=d[c],p=document.createElement("tr");p.className="hover:bg-gray-50";let g="";n?g=`
                    <td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium">
                        <button type="button" class="edit-client-btn text-indigo-600 hover:text-indigo-900 mr-2" 
                                        data-client-id="${l.client_id}">
                            <i class="fas fa-edit"></i> Editar
                
                <button type="button" class="delete-client-btn text-red-600 hover:text-red-900 mr-2" 
                 data-client-id="${l.client_id}" 
               data-client-name="${l.name}">
                 <i class="fas fa-trash"></i> Eliminar
                </button>

                     <button type="button" class="view-debt-btn text-blue-600 hover:text-blue-900" 
                        data-client-id="${l.client_id}" title="Ver ventas y abonos del cliente">
                        <i class="fas fa-file-invoice-dollar"></i> Ver Deuda
                    </button>
                    </td>
                `:g='<td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium"></td>',p.innerHTML=`
                <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${l.client_id}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${l.name}</td>
                <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500">${l.telefono||"N/A"}</td>
                
                <td class="px-3 py-3 whitespace-nowrap text-sm font-semibold text-gray-900">
                    $${i.totalVentas.toFixed(2)}
                </td>
                
                <td class="px-3 py-3 whitespace-nowrap text-sm font-semibold 
                    ${i.deudaNeta>0?"text-red-600":"text-green-600"}">
                    $${i.deudaNeta.toFixed(2)}
                </td>
                
                ${g} 
            `,e.appendChild(p)}),n&&(e.querySelectorAll(".edit-client-btn").forEach(l=>{l.addEventListener("click",()=>{ue(l.dataset.clientId)})}),e.querySelectorAll(".delete-client-btn").forEach(l=>{l.addEventListener("click",()=>{me(l.dataset.clientId,l.dataset.clientName)})}),e.querySelectorAll(".view-debt-btn").forEach(l=>{l.addEventListener("click",()=>{N(l.dataset.clientId)})}))}catch(o){console.error("Error inesperado al cargar clientes:",o.message||o)}}async function te(t){t.preventDefault();const e=document.getElementById("name").value,n=document.getElementById("phone").value,{error:o}=await u.from("clientes").insert([{name:e,telefono:n,is_active:!0}]);if(o)alert("Error al registrar cliente: "+o.message);else{alert("Cliente registrado exitosamente."),await ke();const a=document.getElementById("client-form");a?a.reset():console.warn("Advertencia: No se encontró el formulario 'client-form' para resetear."),closeModal("modal-new-client"),await $()}}function ue(t){if(!u){console.error("Supabase no está inicializado.");return}const e=A.find(r=>String(r.client_id)===String(t));if(!e){alert("Error: Cliente no encontrado para editar.");return}const n=document.getElementById("edit-client-id");n&&(n.value=e.client_id);const o=document.getElementById("edit-client-name");o&&(o.value=e.name);const a=document.getElementById("edit-client-phone");a&&(a.value=e.telefono||""),openModal("edit-client-modal")}async function ne(t){t.preventDefault();const e=document.getElementById("edit-client-id").value,n=document.getElementById("edit-client-name").value.trim(),o=document.getElementById("edit-client-phone").value.trim();if(!e){alert("Error de Edición: No se pudo obtener la ID del cliente.");return}const{error:a}=await u.from("clientes").update({name:n,telefono:o}).eq("client_id",e);a?(console.error("Error al actualizar cliente:",a),alert("Error al actualizar cliente: "+a.message)):(alert("Cliente actualizado exitosamente."),await M(),document.getElementById("edit-client-form").reset(),closeModal("edit-client-modal"))}async function Me(t){var p;if(t.preventDefault(),!u||!S){alert("Error: Supabase no está disponible o el ID del producto a editar es desconocido.");return}const e=document.getElementById("edit-product-name"),n=document.getElementById("edit-product-type"),o=document.getElementById("edit-sale-price"),a=e.value.trim(),r=n.value,d=parseFloat(o.value);let l=null;if(isNaN(d)||d<0||o.value.trim()===""){alert("El precio de venta debe ser un número válido (mayor o igual a cero).");return}if(r==="PACKAGE"){const g=document.getElementById("edit-parent-product-select");if(l=(g==null?void 0:g.value)||null,!l){alert("Los paquetes deben tener un Producto Principal asociado. Seleccione uno de la lista.");return}}const c={name:a,type:r,price:d,parent_product:l},{error:i}=await u.from("productos").update(c).eq("producto_id",S);i?(console.error("Error de Supabase al actualizar producto:",i.message),alert("Error al actualizar producto: "+i.message)):(alert("Producto actualizado exitosamente."),closeModal("modal-edit-product"),S=null,(p=document.getElementById("edit-product-form"))==null||p.reset(),await B(),await q())}function oe(){const t=document.getElementById("new-product-type"),e=document.getElementById("parent-product-container"),n=document.getElementById("parent-product-select");!t||!e||!n||(t.value==="PACKAGE"?(e.classList.remove("hidden"),e.classList.add("block"),n.setAttribute("required","required")):(e.classList.add("hidden"),e.classList.remove("block"),n.removeAttribute("required"),n.value=""))}async function $e(){const t=document.getElementById("products-table-body");if(!t)return;await B(),t.innerHTML="";const e=w;if(e.length===0){t.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">No hay productos registrados.</td></tr>';return}e.forEach(n=>{const o=document.createElement("tr");o.className="hover:bg-gray-50",o.innerHTML=`
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${n.producto_id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${n.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.type}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">${E(n.price)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button data-product-id="${n.producto_id}" class="text-indigo-600 hover:text-indigo-900 edit-product-btn mr-2">Editar</button>
                <button data-product-id="${n.producto_id}" class="text-red-600 hover:text-red-900 delete-product-btn">Eliminar</button>
            </td>
        `,t.appendChild(o)}),document.querySelectorAll(".edit-product-btn").forEach(n=>{n.onclick=()=>{const o=n.getAttribute("data-product-id");openEditProductModal(o)}}),document.querySelectorAll(".delete-product-btn").forEach(n=>{n.onclick=()=>{const o=n.getAttribute("data-product-id");handleDeleteProduct(o)}})}async function De(t){var i;if(t.preventDefault(),!u){alert("Error de conexión: Supabase no está disponible.");return}const e=document.getElementById("new-product-name"),n=document.getElementById("new-product-type"),o=document.getElementById("new-product-price");if(!e||!n||!o){console.error("Error FATAL: No se encontraron todos los campos del formulario en el DOM. Verifique los IDs."),alert("Error al intentar guardar el producto. Verifique los IDs en la consola.");return}const a=e.value.trim(),r=n.value,d=parseFloat(o.value);let l=null;if(isNaN(d)||d<0||o.value.trim()===""){alert("El precio unitario debe ser un número válido (mayor o igual a cero).");return}if(r==="PACKAGE"){const p=document.getElementById("parent-product-select");if(l=(p==null?void 0:p.value)||null,!l){alert("Los paquetes deben tener un Producto Principal asociado. Seleccione uno de la lista.");return}}const{error:c}=await u.from("productos").insert([{name:a,type:r,price:d,parent_product:l}]);c?(console.error("Error de Supabase al registrar producto:",c.message),alert("Error al registrar producto: "+c.message)):(alert("Producto registrado exitosamente."),closeModal("modal-register-product"),(i=document.getElementById("new-product-form"))==null||i.reset(),await B(),await q())}function Se(t){const e=w.find(o=>String(o.producto_id)===String(t));if(!e){alert("Error: Producto no encontrado para edición.");return}document.getElementById("product-id").value=e.producto_id,document.getElementById("edit-product-name").value=e.name,document.getElementById("edit-product-type").value=e.type,document.getElementById("edit-sale-price").value=e.price||0;const n=document.getElementById("edit-parent-product-container");e.type==="PACKAGE"?(n.classList.remove("hidden"),ce("edit-parent-product-select"),document.getElementById("edit-parent-product-select").value=e.parent_product):n.classList.add("hidden"),document.getElementById("product-modal-title").textContent="Editar Producto: "+e.name}function Ce(t){S=t,Se(t),openModal("modal-edit-product")}let C=null;function Pe(t){C=t;const e=w.find(n=>String(n.producto_id)===String(t));e&&(document.getElementById("delete-product-name-placeholder").textContent=e.name),openModal("modal-delete-confirmation")}async function Ae(){if(!C)return;const{error:t}=await u.from("productos").delete().eq("producto_id",C);t?(console.error("Error al eliminar producto:",t.message),alert("Error al eliminar producto: "+t.message)):(alert("Producto eliminado exitosamente."),closeModal("modal-delete-confirmation"),C=null,await B(),await q())}let O=null;function me(t,e){O=t;const n=document.getElementById("delete-client-name-placeholder");n&&(n.textContent=e),openModal("client-delete-confirmation")}async function Te(){const t=O;if(!t){alert("Error de Eliminación: ID del cliente no encontrada.");return}const{error:e}=await u.from("clientes").delete().eq("client_id",t);if(e){console.error("Error al intentar eliminar el cliente:",e),e.code==="23503"?alert("❌ ERROR: No se puede eliminar el cliente. Tiene ventas o abonos pendientes asociados. Asegúrate de eliminar el historial del cliente o configurar la eliminación en cascada en Supabase."):alert("❌ Error desconocido al eliminar cliente: "+e.message),closeModal("client-delete-confirmation");return}alert("✅ Cliente eliminado definitivamente."),closeModal("client-delete-confirmation"),O=null,await M()}var ae;(ae=document.getElementById("confirm-delete-client-btn"))==null||ae.addEventListener("click",Te);function Ne(t){var n;const e=document.getElementById("abono-client-id-input");e&&(e.value=t),(n=document.getElementById("abono-client-form"))==null||n.reset(),openModal("modal-record-abono")}async function F(){const t=document.getElementById("report-month-selector"),e=document.getElementById("monthly-sales-report-body"),n=document.getElementById("report-total-sales"),o=document.getElementById("monthly-report-no-data"),a=t?t.value:null;let r,d;if(a){const[m,y]=a.split("-").map(Number);r=new Date(m,y-1,1),d=new Date(m,y,0),d.setHours(23,59,59,999)}else{const m=new Date;r=new Date(m.getFullYear(),m.getMonth(),1),d=new Date(m.getFullYear(),m.getMonth()+1,0),d.setHours(23,59,59,999)}const l=r.toISOString(),c=d.toISOString(),{data:i,error:p}=await u.from("ventas").select(`
            venta_id, 
            created_at, 
            client_id, 
            total_amount, 
            saldo_pendiente, 
            metodo_pago, 
            description
        `).gte("created_at",l).lte("created_at",c).order("created_at",{ascending:!1});if(p){console.error("Error al cargar reporte de ventas:",p.message),alert("Error al cargar reporte de ventas. Consulte la consola."),e.innerHTML="",n.textContent="$0.00",o.classList.remove("hidden");return}let g=0;e.innerHTML="",i&&i.length>0?(o.classList.add("hidden"),i.forEach(m=>{g+=m.total_amount;const y=new Date(m.created_at).toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric"}),f=le[m.client_id]||"N/A",v=e.insertRow();v.className="hover:bg-gray-50";const I=m.description||"-";v.innerHTML=`
                <td class="px-3 py-3 whitespace-nowrap">${m.venta_id}</td>
                <td class="px-3 py-3 whitespace-nowrap">${y}</td>
                <td class="px-3 py-3 whitespace-nowrap">${f}</td>
                <td class="px-3 py-3 whitespace-nowrap font-semibold">${E(m.total_amount)}</td>
                <td class="px-3 py-3 whitespace-nowrap text-red-600">${E(m.saldo_pendiente)}</td>
                <td class="px-3 py-3 whitespace-nowrap">${m.metodo_pago}</td>
                 
               <td class="px-3 py-3 text-sm truncate-cell">
                <div class="truncate w-40" title="${I}">
                  ${I}
                   < /div>
                <td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium">
                    <button 
                        data-venta-id="${m.venta_id}" 
                        data-client-id="${m.client_id}"
                        class="view-sale-details-btn text-indigo-600 hover:text-indigo-900 font-semibold text-xs py-1 px-2 rounded bg-indigo-100"
                    >
                        Detalles
                    </button>
                </td>
            `})):o.classList.remove("hidden"),n.textContent=E(g)}function qe(){const t=document.getElementById("report-month-selector");if(!t)return;t.innerHTML="";const e=new Date,n=e.getFullYear(),o=e.getMonth(),a=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];for(let r=0;r<12;r++){const d=new Date(n,o-r,1),l=d.getFullYear(),c=d.getMonth(),i=`${l}-${String(c+1).padStart(2,"0")}`,p=`${a[c]} ${l}`,g=document.createElement("option");g.value=i,g.textContent=p,r===0&&(g.selected=!0),t.appendChild(g)}}async function Fe(t){const{data:e,error:n}=await u.from("ventas").select("*, clientes(name), detalle_ventas (quantity, price, subtotal, productos(name))").eq("venta_id",t).single();if(n||!e)return;let o=`
        <div style="text-align: center; font-family: monospace;">
            <h3>Creativa CNC</h3>
            <p>${e.clientes.name}</p>
            <hr>
            <table style="width: 100%; border-collapse: collapse;">
                ${e.detalle_ventas.map(a=>`
                    <tr>
                        <td style="text-align: left;">${a.quantity} ${a.productos.name}</td>
                        <td style="text-align: right;">${E(a.subtotal)}</td>
                    </tr>
                `).join("")}
            </table>
            <hr>
            <h4 style="text-align: right;">TOTAL: ${E(e.total_amount)}</h4>
            <p>¡Gracias por su compra!</p>
        </div>
    `;document.getElementById("ticket-preview-content").innerHTML=o,openModal("modal-ticket-preview")}async function He(){const{data:t,error:e}=await u.from("clientes").select("client_id, name");if(e){console.error("Error al cargar datos de clientes para el mapa:",e);return}le=t.reduce((n,o)=>(n[o.client_id]=o.name,n),{})}async function ke(){const t=document.getElementById("clients-list-body"),e=document.getElementById("clients-list-controls"),n=document.getElementById("toggle-clients-list"),o=document.getElementById("client-count-summary"),{data:a,error:r}=await u.from("clientes").select("client_id, name, phone").order("client_id",{ascending:!1});if(r){console.error("Error al cargar clientes:",r.message);return}t.innerHTML="";const d=10,l=a.length;let c=!1;if(a.forEach((i,p)=>{const g=!c&&p>=d,m=t.insertRow();m.className=g?"hidden":"hover:bg-gray-50",m.dataset.clientId=i.client_id,m.innerHTML=`
            <td class="px-3 py-2 whitespace-nowrap">${i.client_id}</td>
            <td class="px-3 py-2 whitespace-nowrap font-medium">${i.name}</td>
            <td class="px-3 py-2 whitespace-nowrap">${i.phone||"-"}</td>
            <td class="px-3 py-2 whitespace-nowrap">
                <button data-client-id="${i.client_id}" class="edit-client-btn text-blue-600 hover:text-blue-800 text-sm mr-2">Editar</button>
                <button data-client-id="${i.client_id}" class="delete-client-btn text-red-600 hover:text-red-800 text-sm">Eliminar</button>
            </td>
        `}),l>d){e.classList.remove("hidden"),o.textContent=`Mostrando ${d} de ${l} clientes.`;const i=()=>{c=!c,t.querySelectorAll("tr").forEach((g,m)=>{m>=d&&g.classList.toggle("hidden",!c)}),n.textContent=c?"Mostrar menos":`Mostrar los ${l-d} restantes`,o.textContent=c?`Mostrando todos (${l}) clientes.`:`Mostrando ${d} de ${l} clientes.`};n.onclick=i,i()}else e.classList.add("hidden")}async function q(){const t=document.getElementById("products-table-body");if(!t){console.error("Error: No se encontró el <tbody> con ID 'products-table-body'.");return}if(t.innerHTML="",w.length===0){t.innerHTML='<tr><td colspan="5" class="text-center py-4 text-gray-500">No hay productos registrados.</td></tr>';return}w.forEach(e=>{let n="";if(e.type==="PACKAGE")if(e.parent_product){const d=w.find(l=>String(l.producto_id)===String(e.parent_product));n=d?`<span class="text-xs text-gray-500 ml-1">(Padre: ${d.name})</span>`:'<span class="text-xs text-red-500 ml-1">(ID Padre No Válida/Eliminada)</span>'}else n='<span class="text-xs text-red-500 ml-1">(Sin Padre Asociado)</span>';const o=e.type==="PACKAGE"?"Paquete/Servicio":"Producto Individual",a=e.price?parseFloat(e.price).toFixed(2):"0.00",r=t.insertRow();r.className="hover:bg-gray-50",r.innerHTML=`
            <td class="px-3 py-2 whitespace-nowrap">${e.producto_id}</td>
            <td class="px-3 py-2 whitespace-nowrap font-medium">
                ${e.name} ${n}
            </td>
            <td class="px-3 py-2 whitespace-nowrap">${o}</td>
            <td class="px-3 py-2 whitespace-nowrap">$${a}</td>
            <td class="px-3 py-2 whitespace-nowrap">
                <button data-product-id="${e.producto_id}" class="edit-product-btn text-blue-600 hover:text-blue-800 text-sm mr-2">Editar</button>
                <button data-product-id="${e.producto_id}" class="delete-product-btn text-red-600 hover:text-red-800 text-sm">Eliminar</button>
            </td>
        `})}document.addEventListener("DOMContentLoaded",async()=>{var e,n,o,a,r,d,l,c,i,p,g,m,y,f,v,I,D,L,_,Y,U,G,K,J,X,Z,j,Q,W;if(window.supabase)u=window.supabase.createClient(re,de);else{console.error("Error Fatal: Librería Supabase no encontrada. La aplicación no funcionará.");return}z(),await B(),await He(),(e=document.getElementById("open-sale-modal-btn"))==null||e.addEventListener("click",async()=>{}),document.querySelectorAll("[data-close-modal]").forEach(s=>{}),(n=document.getElementById("open-sale-modal-btn"))==null||n.addEventListener("click",async()=>{var s;try{(s=document.getElementById("new-sale-form"))==null||s.reset(),await ie(),await B(),H(),x=[],T(),document.getElementById("total-amount").value="0.00",document.getElementById("paid-amount").value="0.00",document.getElementById("remaining-balance").value="0.00",openModal("new-sale-modal")}catch(h){console.error("Error al cargar datos del modal de venta:",h),alert("Error al cargar los datos. Revise la consola (F12).")}}),document.querySelectorAll("[data-close-modal]").forEach(s=>{s.addEventListener("click",h=>{h.preventDefault();const b=s.getAttribute("data-close-modal");closeModal(b)})}),(o=document.getElementById("new-sale-form"))==null||o.addEventListener("submit",Le),(a=document.getElementById("paid-amount"))==null||a.addEventListener("input",()=>k()),(r=document.getElementById("payment-method"))==null||r.addEventListener("change",()=>k()),(d=document.getElementById("add-product-btn"))==null||d.addEventListener("click",xe),qe(),H(),(l=document.getElementById("report-month-selector"))==null||l.addEventListener("change",F),F(),(c=document.getElementById("login-form"))==null||c.addEventListener("submit",fe),(i=document.getElementById("logout-btn"))==null||i.addEventListener("click",Ee),(p=document.getElementById("sales-month-filter"))==null||p.addEventListener("change",()=>{M()}),(g=document.getElementById("reset-sales-filter"))==null||g.addEventListener("click",()=>{const s=document.getElementById("sales-month-filter");s&&(s.value=""),M()}),(m=document.getElementById("open-monthly-report-btn"))==null||m.addEventListener("click",()=>{F(),openModal("modal-monthly-report")}),(y=document.getElementById("admin-clients-btn"))==null||y.addEventListener("click",async()=>{openModal("modal-admin-clients"),await $("gestion")});const t=document.getElementById("modal-monthly-report");t==null||t.addEventListener("click",s=>{if(s.target.classList.contains("view-sale-details-btn")){const h=s.target.getAttribute("data-venta-id"),b=s.target.getAttribute("data-client-id");se(h,b)}}),(f=document.getElementById("open-register-client-modal-btn"))==null||f.addEventListener("click",()=>{document.getElementById("client-modal-title").textContent="Registrar Nuevo Cliente";const s=document.getElementById("new-client-form");s==null||s.reset(),s==null||s.removeEventListener("submit",ne),s==null||s.addEventListener("submit",te),openModal("modal-register-client")}),(v=document.getElementById("new-client-form"))==null||v.addEventListener("submit",te),(I=document.getElementById("post-sale-price-form"))==null||I.addEventListener("submit",async s=>{s.preventDefault();const h=document.getElementById("edit-venta-id").value,b=document.getElementById("edit-detalle-venta-id").value,pe=document.getElementById("edit-client-id").value,ge=parseFloat(document.getElementById("new-unit-price").value);await Ie(h,b,pe,ge),closeModal("modal-edit-sale-item")}),(D=document.getElementById("open-admin-products-modal"))==null||D.addEventListener("click",async()=>{try{await B(),await q(),openModal("admin-products-modal")}catch(s){console.error("Error al cargar la administración de productos:",s),alert("Error al cargar la lista de productos.")}}),(L=document.getElementById("open-product-modal-btn"))==null||L.addEventListener("click",()=>{var s;closeModal("admin-products-modal"),(s=document.getElementById("new-product-form"))==null||s.reset(),oe(),openModal("modal-register-product")}),(_=document.getElementById("new-product-type"))==null||_.addEventListener("change",s=>{oe(),s.target.value==="PACKAGE"&&ce("parent-product-select")}),(Y=document.getElementById("new-product-form"))==null||Y.addEventListener("submit",De),(U=document.getElementById("products-table-body"))==null||U.addEventListener("click",s=>{if(!s.target.hasAttribute("data-product-id"))return;const h=s.target.getAttribute("data-product-id");s.target.classList.contains("edit-product-btn")&&(s.preventDefault(),Ce(h)),s.target.classList.contains("delete-product-btn")&&(s.preventDefault(),Pe(h))}),(G=document.getElementById("clients-list-body"))==null||G.addEventListener("click",async s=>{const h=s.target.closest("button");if(h){s.preventDefault();const b=h.getAttribute("data-client-id");h.classList.contains("edit-client-btn")&&await ue(b),h.classList.contains("delete-client-btn")&&me(b),h.classList.contains("view-debt-btn")&&await N(b)}}),(K=document.getElementById("edit-client-form"))==null||K.addEventListener("submit",ne),(J=document.getElementById("open-abono-from-report-btn"))==null||J.addEventListener("click",()=>{closeModal("modal-client-debt-report"),Ne(V)}),document.addEventListener("click",s=>{document.querySelectorAll(".modal-overlay:not(.hidden)").forEach(b=>{s.target===b&&closeModal(b.id)})}),document.querySelectorAll("[data-open-modal]").forEach(s=>{s.addEventListener("click",h=>{h.preventDefault();const b=s.getAttribute("data-open-modal");openModal(b)})}),(X=document.getElementById("confirm-delete-btn"))==null||X.addEventListener("click",Ae),(Z=document.getElementById("edit-product-form"))==null||Z.addEventListener("submit",Me),(j=document.getElementById("product-main-select"))==null||j.addEventListener("change",we),(Q=document.getElementById("subproduct-select"))==null||Q.addEventListener("change",s=>{R(s.target.value)}),(W=document.getElementById("abono-client-form"))==null||W.addEventListener("submit",Be),document.addEventListener("keydown",s=>{if(s.key==="Escape"){const h=document.querySelectorAll(".modal-overlay:not(.hidden)"),b=h[h.length-1];b&&closeModal(b.id)}})});
