(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();const K="https://wnwftbamyaotqdsivmas.supabase.co",G="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indud2Z0YmFteWFvdHFkc2l2bWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1OTY0OTcsImV4cCI6MjA3OTE3MjQ5N30.r8Fh7FUYOnUQHboqfKI1eb_37NLuAn3gRLbH8qUPpMo";let c,B=[],b=[],A=null;try{if(!window.supabase)throw new Error("Librería Supabase no encontrada.");c=window.supabase.createClient(K,G)}catch(t){console.error("Error Fatal: Supabase no inicializó.",t),document.getElementById("auth-container").style.display="flex"}function v(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)}function V(t){const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(t).toLocaleDateString("es-MX",e)}window.openModal=function(t){const e=document.getElementById(t);e&&(e.classList.add("flex"),e.classList.remove("hidden"))};window.closeModal=function(t){const e=document.getElementById(t);e&&(e.classList.add("hidden"),e.classList.remove("flex"))};async function D(){const{data:{user:t}}=await c.auth.getUser(),e=document.getElementById("auth-container"),a=document.getElementById("main-app-content");t?(e.classList.add("hidden"),a.classList.remove("hidden"),await P()):(e.classList.remove("hidden"),a.classList.add("hidden"))}async function Y(t){t.preventDefault();const e=document.getElementById("email").value,a=document.getElementById("password").value,{error:n}=await c.auth.signInWithPassword({email:e,password:a});n?alert(n.message):D()}async function j(){await c.auth.signOut(),D()}async function Z(){const{data:t,error:e}=await c.from("ventas").select("total_amount");if(e){console.error("Error al cargar ventas:",e),document.getElementById("total-sales").textContent=v(0);return}const a=t.reduce((d,s)=>d+s.total_amount,0);document.getElementById("total-sales").textContent=v(a);const{data:n,error:o}=await c.from("ventas").select("saldo_pendiente").gt("saldo_pendiente",0);if(o){console.error("Error al cargar deudas:",o),document.getElementById("total-debt").textContent=v(0);return}const r=n.reduce((d,s)=>d+s.saldo_pendiente,0);document.getElementById("total-debt").textContent=v(r)}async function Q(){const{data:t,error:e}=await c.from("ventas").select("venta_id, created_at, total_amount, saldo_pendiente, clientes(name)").gt("saldo_pendiente",.01).order("created_at",{ascending:!1}).limit(5);if(e){console.error("Error al cargar tabla de deudas:",e);return}const a=document.getElementById("debt-table-body");if(a){if(a.innerHTML="",t.length===0){a.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">No hay deudas pendientes.</td></tr>';return}t.forEach(n=>{var d;const o=((d=n.clientes)==null?void 0:d.name)||"Cliente Desconocido",r=document.createElement("tr");r.className="hover:bg-gray-50",r.innerHTML=`
            <td class="px-6 py-4 whitespace-nowrap text-sm text-black font-bold">${o}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${V(n.created_at)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${v(n.total_amount)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600">${v(n.saldo_pendiente)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                
                <button 
                    onclick="openSaleDetailModal(${n.venta_id})" 
                    class="text-indigo-600 hover:text-indigo-900 font-semibold text-xs py-1 px-2 rounded bg-indigo-100 mr-2"
                >
                    Detalles
                </button>
                
                <button 
                    onclick="openSaleDetailModal(${n.venta_id})" 
                    class="text-green-600 hover:text-green-900 font-semibold text-xs py-1 px-2 rounded bg-green-100"
                >
                    Pagar
                </button>
            </td>
        `,a.appendChild(r)})}}async function P(){await Z(),await Q(),await L(),await h(),await T()}async function N(){const t=document.getElementById("client-select");if(!t)return;t.innerHTML='<option value="" disabled selected>Cargando clientes...</option>';const{data:e,error:a}=await c.from("clientes").select("client_id, name").eq("is_active",!0).order("name",{ascending:!0});if(a){console.error("Error al cargar clientes para venta:",a),t.innerHTML='<option value="" disabled selected>Error al cargar (revisar consola)</option>';return}if(e.length===0){t.innerHTML='<option value="" disabled selected>No hay clientes activos</option>';return}t.innerHTML='<option value="" disabled selected>Seleccione un Cliente</option>',e.forEach(n=>{const o=document.createElement("option");o.value=n.client_id,o.textContent=n.name,t.appendChild(o)})}async function h(){const{data:t,error:e}=await c.from("productos").select("producto_id, name, type, price, parent_product");if(e){console.error("Error al cargar todos los productos:",e),B=[];return}B=t||[]}async function C(t){const e=B.filter(n=>n.type==="MAIN"),a=document.getElementById(t);a&&(a.innerHTML='<option value="" disabled selected>Seleccione Producto Principal</option>',e.forEach(n=>{const o=document.createElement("option");o.value=n.name,o.textContent=n.name,a.appendChild(o)}))}function W(t){const e=document.getElementById("subproduct-select"),a=document.getElementById("product-unit-price");if(!e||!a)return;e.innerHTML="",e.disabled=!0;const n=B.filter(r=>r.type==="PACKAGE"&&r.parent_product===t);let o=B.find(r=>r.name===t&&r.type==="MAIN");if(e.innerHTML='<option value="" data-price="0" disabled selected>Seleccione un Paquete/Base</option>',n.length>0&&n.forEach(r=>{const d=document.createElement("option");d.value=r.producto_id,d.textContent=`${r.name} (Paquete) - ${v(r.price)}`,d.dataset.price=r.price,e.appendChild(d)}),o){const r=document.createElement("option");r.value=o.producto_id,r.textContent=`[Precio Base] - ${v(o.price)}`,r.dataset.price=o.price,e.appendChild(r),n.length===0?(e.value=o.producto_id,a.value=o.price.toFixed(2)):a.value="0.00"}else a.value="0.00";e.disabled=!1}function S(){const t=document.getElementById("total-amount"),e=document.getElementById("paid-amount"),a=document.getElementById("remaining-balance"),n=b.reduce((d,s)=>d+s.subtotal,0);t&&(t.value=n.toFixed(2));const o=parseFloat(e==null?void 0:e.value)||0,r=Math.max(0,n-o);a&&(a.value=r.toFixed(2))}function $(){const t=document.getElementById("sale-items-container");if(t){if(t.innerHTML="",b.length===0){t.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">Agrega productos a la venta.</td></tr>';return}b.forEach((e,a)=>{const n=document.createElement("tr");n.className="hover:bg-gray-50",n.dataset.index=a;const o=e.parent_product_name&&e.parent_product_name!==e.name?`${e.name} (${e.parent_product_name})`:e.name;n.innerHTML=`
            <td class="px-6 py-3 text-sm font-medium text-gray-900">${o}</td>
            <td class="px-6 py-3 text-sm text-gray-500">${v(e.price)}</td>
            <td class="px-6 py-3 text-sm text-gray-500">${e.quantity}</td>
            <td class="px-6 py-3 text-sm font-bold">${v(e.subtotal)}</td>
            <td class="px-6 py-3 text-right text-sm font-medium">
                <button type="button" onclick="removeItemFromSale(${a})" 
                        class="text-red-600 hover:text-red-900">
                    <i class="fas fa-times-circle"></i>
                </button>
            </td>
        `,t.appendChild(n)}),S()}}window.removeItemFromSale=function(t){b.splice(t,1),$(),S()};function ee(t){var E,m,y;t.preventDefault();const e=document.getElementById("product-main-select"),a=document.getElementById("subproduct-select"),n=document.getElementById("product-quantity"),o=document.getElementById("product-unit-price"),r=a==null?void 0:a.value,d=(E=a==null?void 0:a.selectedOptions[0])==null?void 0:E.textContent,s=parseFloat(n==null?void 0:n.value),u=parseFloat(o==null?void 0:o.value),f=((y=(m=e==null?void 0:e.selectedOptions[0])==null?void 0:m.textContent)==null?void 0:y.trim())??null;if(!r||r===""){alert("Por favor, selecciona un Paquete/Subcategoría o Precio Base.");return}if(isNaN(s)||s<=0){alert("La cantidad debe ser mayor a cero.");return}if(isNaN(u)||u<0){alert("El precio debe ser un valor válido.");return}const w=s*u,x={product_id:r,name:d.split("(")[0].trim().replace("[Precio Base]","").trim(),quantity:s,price:u,subtotal:w,parent_product_name:f};b.push(x),$(),document.getElementById("product-main-select").value="",a.innerHTML='<option value="" disabled selected>Seleccione Principal primero</option>',a.disabled=!0,n.value="1",o.value="0.00"}async function te(t){var f,w,x,E;t.preventDefault();const e=((f=document.getElementById("client-select"))==null?void 0:f.value)??null,a=((w=document.getElementById("paid-amount"))==null?void 0:w.value)??"0",n=((x=document.getElementById("payment-method"))==null?void 0:x.value)??"Efectivo",o=((E=document.getElementById("sale-description"))==null?void 0:E.value.trim())??null,r=b,d=r.reduce((m,y)=>m+y.subtotal,0),s=parseFloat(a),u=d-s;if(!e){alert("Por favor, selecciona un cliente.");return}if(r.length===0){alert("Debes agregar al menos un producto a la venta.");return}if(s>d){alert("El monto pagado no puede ser mayor que el total de la venta.");return}try{const{data:m,error:y}=await c.from("ventas").insert([{client_id:e,total_amount:d,paid_amount:s,saldo_pendiente:u,metodo_pago:n,description:o}]).select("venta_id");if(y||!m||m.length===0){console.error("Error al insertar venta:",y),alert(`Error al registrar la venta: ${(y==null?void 0:y.message)||"Desconocido"}`);return}const I=m[0].venta_id,M=r.map(g=>({venta_id:I,product_id:g.product_id,name:g.name,quantity:g.quantity,price:g.price,subtotal:g.subtotal})),{error:_}=await c.from("detalle_ventas").insert(M);if(_&&(console.error("Error al insertar detalles de venta:",_),alert(`Venta registrada (ID: ${I}), pero falló el registro de detalles: ${_.message}`)),s>0){const{error:g}=await c.from("pagos").insert([{venta_id:I,amount:s,client_id:e,metodo_pago:n}]);g&&(console.error("Error al registrar pago inicial:",g),alert(`Advertencia: El pago inicial falló. ${g.message}`))}alert("Venta, detalles y pago (si aplica) registrados exitosamente."),closeModal("new-sale-modal"),await P()}catch(m){console.error("Error fatal al registrar la venta:",m.message),alert("Error fatal al registrar la venta: "+m.message)}finally{b=[],$(),document.getElementById("new-sale-form").reset()}}async function L(){const{data:t,error:e}=await c.from("clientes").select("client_id, name, telefono").order("name",{ascending:!0});if(e){console.error("Error al cargar clientes:",e);return}const a=document.getElementById("clients-table-body"),n=document.getElementById("admin-clients-table-body"),o=[a,n].filter(r=>r);if(o.length!==0){if(o.forEach(r=>r.innerHTML=""),t.length===0){const r='<tr><td colspan="3" class="px-6 py-4 text-center text-gray-500 italic">No hay clientes registrados.</td></tr>';o.forEach(d=>d.innerHTML=r);return}t.forEach(r=>{const d=`
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${r.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${r.telefono||"N/A"}</td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button data-client-id="${r.client_id}" class="text-indigo-600 hover:text-indigo-900 edit-client-btn mr-2">Editar</button>
                <button data-client-id="${r.client_id}" class="text-red-600 hover:text-red-900 delete-client-btn">Eliminar</button>
            </td>
        `;o.forEach(s=>{const u=document.createElement("tr");u.className="hover:bg-gray-50",u.innerHTML=d,s.appendChild(u)})})}}async function ne(t){t.preventDefault();const e=document.getElementById("new-client-name").value,a=document.getElementById("new-client-phone").value,{error:n}=await c.from("clientes").insert([{name:e,telefono:a,is_active:!0}]);n?alert("Error al registrar cliente: "+n.message):(alert("Cliente registrado exitosamente."),closeModal("new-client-modal"),await L(),await N())}async function k(t){const{data:e,error:a}=await c.from("clientes").select("name, telefono").eq("client_id",t).single();if(a||!e){alert("Error al cargar datos del cliente para editar: "+((a==null?void 0:a.message)||"No encontrado"));return}A=t,document.getElementById("edit-client-name").value=e.name,document.getElementById("edit-client-phone").value=e.telefono||"",openModal("edit-client-modal")}async function ae(t){if(t.preventDefault(),!A)return;const e=document.getElementById("edit-client-name").value,a=document.getElementById("edit-client-phone").value,{error:n}=await c.from("clientes").update({name:e,telefono:a}).eq("client_id",A);n?alert("Error al actualizar cliente: "+n.message):(alert("Cliente actualizado exitosamente."),closeModal("edit-client-modal"),await L(),await N())}async function R(t){if(!confirm("ADVERTENCIA: ¿Estás seguro de ELIMINAR PERMANENTEMENTE este cliente? Se borrarán todas sus ventas, pagos y deudas relacionadas."))return;const{error:e}=await c.rpc("delete_client_cascade",{client_to_delete_id:t});e?alert("Error al eliminar cliente: "+e.message+" Asegúrate de tener configurado el RPC `delete_client_cascade`."):(alert("Cliente y todos sus registros relacionados eliminados exitosamente."),await L(),await N(),await P())}window.loadSalesList=async function(){const t=document.getElementById("sales-list-body");t.innerHTML='<tr><td colspan="6" class="p-4 text-center">Cargando ventas...</td></tr>';const{data:e,error:a}=await c.from("ventas").select(`
            venta_id, 
            created_at, 
            total_amount, 
            saldo_pendiente, 
            clientes ( name ) // Usando 'clientes'
        `).order("created_at",{ascending:!1});if(a){console.error("Error al cargar la lista de ventas:",a),t.innerHTML='<tr><td colspan="6" class="p-4 text-center text-red-500">Error al cargar las ventas.</td></tr>';return}if(t.innerHTML="",e.length===0){t.innerHTML='<tr><td colspan="6" class="p-4 text-center text-gray-500">No hay ventas registradas.</td></tr>';return}e.forEach(n=>{const o=t.insertRow(),r=new Date(n.created_at).toLocaleDateString(),d=n.total_amount.toFixed(2),s=n.saldo_pendiente.toFixed(2),u=n.clientes.name;o.className=`cursor-pointer hover:bg-gray-100 ${n.saldo_pendiente>0?"bg-yellow-50":""}`,o.setAttribute("data-venta-id",n.venta_id),o.innerHTML=`
            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${n.venta_id}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-900">${u}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${r}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm font-bold text-right">$${d}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm font-bold text-right text-red-600">$${s}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm text-center">
                <button onclick="openSaleDetailModal(${n.venta_id})" class="text-indigo-600 hover:text-indigo-900 font-semibold text-xs">Ver Detalle</button>
            </td>
        `}),document.getElementById("sales-search").onkeyup=function(){oe(this.value)}};window.openSaleDetailModal=async function(t){const{data:e,error:a}=await c.from("ventas").select(`
            *, 
            clientes ( name ),
            detalle_ventas ( name, quantity, price, subtotal ),
            pagos ( created_at, amount, metodo_pago )
        `).eq("venta_id",t).single();if(a||!e){console.error("Error al cargar detalle de venta:",a),alert("No se pudo cargar el detalle de la venta.");return}const n=d=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(d);document.getElementById("detail-sale-id").textContent=`#${e.venta_id}`,document.getElementById("detail-client-name").textContent=e.clientes.name,document.getElementById("detail-description").textContent=e.description||"Sin descripción",document.getElementById("detail-total-amount").textContent=n(e.total_amount),document.getElementById("detail-paid-amount").textContent=n(e.paid_amount),document.getElementById("detail-saldo-pendiente").textContent=n(e.saldo_pendiente);const o=document.getElementById("detail-products-body");o.innerHTML="",e.detalle_ventas.forEach(d=>{o.innerHTML+=`
            <tr>
                <td class="px-6 py-2 whitespace-nowrap">${d.name}</td>
                <td class="px-6 py-2 whitespace-nowrap text-center">${d.quantity}</td>
                <td class="px-6 py-2 whitespace-nowrap text-right">${n(d.price)}</td>
                <td class="px-6 py-2 whitespace-nowrap text-right font-semibold">${n(d.subtotal)}</td>
            </tr>
        `});const r=document.getElementById("detail-payments-body");r.innerHTML="",e.pagos.length===0?r.innerHTML='<tr><td colspan="3" class="px-6 py-2 text-center text-gray-500">No hay abonos registrados.</td></tr>':(e.pagos.sort((d,s)=>new Date(s.created_at)-new Date(d.created_at)),e.pagos.forEach(d=>{const s=new Date(d.created_at).toLocaleDateString("es-MX",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"});r.innerHTML+=`
                <tr>
                    <td class="px-6 py-2 whitespace-nowrap">${s}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-right font-semibold text-green-700">${n(d.amount)}</td>
                    <td class="px-6 py-2 whitespace-nowrap text-center">${d.metodo_pago}</td>
                </tr>
            `})),document.getElementById("payment-sale-id").value=e.venta_id,document.getElementById("abono-amount").value="",document.getElementById("abono-amount").setAttribute("max",e.saldo_pendiente),document.getElementById("submit-abono-btn").disabled=e.saldo_pendiente<=.01,document.getElementById("submit-abono-btn").textContent=e.saldo_pendiente<=.01?"Saldada":"Abonar",openModal("sale-detail-modal")};function oe(t){const e=document.getElementById("sales-list-body").querySelectorAll("tr"),a=t.toLowerCase();e.forEach(n=>{n.textContent.toLowerCase().includes(a)?n.style.display="":n.style.display="none"})}var U;(U=document.getElementById("register-payment-form"))==null||U.addEventListener("submit",re);async function re(t){t.preventDefault();const e=document.getElementById("payment-sale-id").value,a=document.getElementById("abono-amount").value.trim(),n=document.getElementById("payment-method-abono").value,o=parseFloat(a),r=y=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(y);if(a===""||isNaN(o)||o<=0){alert("Por favor, ingresa un monto válido para el abono (mayor a cero).");return}const{data:d,error:s}=await c.from("ventas").select("total_amount, paid_amount, saldo_pendiente, client_id").eq("venta_id",e).single();if(s||!d){alert("Error al obtener datos de la venta para el abono.");return}if(d.saldo_pendiente<=.01){alert("Esta venta ya está saldada.");return}const u=d.saldo_pendiente;o>u&&alert(`Advertencia: El abono excede el saldo pendiente. Solo se aplicará el monto restante: ${r(u)}.`);const f=Math.min(o,u),w=d.paid_amount+f,x=d.total_amount-w,{error:E}=await c.from("pagos").insert([{venta_id:e,amount:f,client_id:d.client_id,metodo_pago:n}]);if(E){alert("Error al registrar el abono: "+E.message);return}const{error:m}=await c.from("ventas").update({paid_amount:w,saldo_pendiente:x}).eq("venta_id",e);alert(m?"Advertencia: El abono se registró, pero falló la actualización del saldo en la venta. Contacte soporte.":`Abono de ${r(f)} registrado exitosamente.`),closeModal("sale-detail-modal"),await loadSalesList(),openModal("admin-sales-modal"),await P()}function X(){var a;const t=(a=document.getElementById("new-product-type"))==null?void 0:a.value,e=document.getElementById("parent-product-container");e&&(t==="PACKAGE"?(e.classList.remove("hidden"),C("parent-product-select")):e.classList.add("hidden"))}async function T(){await h();const t=document.getElementById("products-table-body");if(!t)return;t.innerHTML="";const e=B;if(e.length===0){t.innerHTML='<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">No hay productos registrados.</td></tr>';return}e.forEach(a=>{const n=document.createElement("tr");n.className="hover:bg-gray-50",n.innerHTML=`
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${a.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${a.type}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${a.parent_product||"N/A"}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">${v(a.price)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button data-product-id="${a.producto_id}" class="text-indigo-600 hover:text-indigo-900 edit-product-btn mr-2">Editar</button>
                <button data-product-id="${a.producto_id}" class="text-red-600 hover:text-red-900 delete-product-btn">Eliminar</button>
            </td>
        `,t.appendChild(n)})}async function z(t){t.preventDefault();const e=document.getElementById("new-product-name").value,a=parseFloat(document.getElementById("new-product-price").value),n=document.getElementById("new-product-type").value,o=document.getElementById("parent-product-select").value||null;if(n==="PACKAGE"&&!o){alert("Los paquetes deben tener un Producto Principal asociado.");return}if(isNaN(a)||a<0){alert("El precio debe ser un número válido (mayor o igual a cero).");return}const{error:r}=await c.from("productos").insert([{name:e,price:a,type:n,parent_product:o}]);r?alert("Error al registrar producto: "+r.message):(alert("Producto registrado exitosamente."),closeModal("new-product-modal"),await h(),await T())}async function de(t){if(!t)return;const{data:e,error:a}=await c.from("productos").select("*").eq("producto_id",t).single();if(a){console.error("Error al cargar producto para edición:",a),alert(`Error al cargar producto: ${a.message}`);return}const n=document.getElementById("new-product-form");document.getElementById("modal-title-product").textContent=`Editar Producto: ${e.name}`,document.getElementById("new-product-name").value=e.name,document.getElementById("new-product-price").value=e.price,document.getElementById("new-product-type").value=e.type,document.getElementById("new-product-description").value=e.description||"",n&&(n.dataset.editingId=t,n.removeEventListener("submit",z),n.addEventListener("submit",J))}async function J(t){t.preventDefault()}async function se(t){if(!confirm("¿Estás seguro de eliminar este producto? Esto podría causar errores si está vinculado a ventas existentes."))return;const{error:e}=await c.from("productos").delete().eq("producto_id",t);e?alert("Error al eliminar producto: "+e.message):(alert("Producto eliminado exitosamente."),await h(),await T())}async function le(t){t.preventDefault()}document.addEventListener("DOMContentLoaded",()=>{var t,e,a,n,o,r,d,s,u,f,w,x,E,m,y,I,M,_,g,H,F,q;D(),(t=document.getElementById("login-form"))==null||t.addEventListener("submit",Y),(e=document.getElementById("logout-button"))==null||e.addEventListener("click",j),(a=document.getElementById("open-new-sale-modal"))==null||a.addEventListener("click",async()=>{try{await N(),await h(),await C("product-main-select"),b=[],$(),document.getElementById("total-amount").value="0.00",document.getElementById("paid-amount").value="0.00",document.getElementById("remaining-balance").value="0.00",openModal("new-sale-modal")}catch(i){console.error("Error al cargar datos de selects:",i),alert("Error al cargar los datos. Revise la consola (F12).")}}),(n=document.getElementById("new-sale-form"))==null||n.addEventListener("submit",te),(o=document.getElementById("add-product-btn"))==null||o.addEventListener("click",ee),(r=document.getElementById("paid-amount"))==null||r.addEventListener("input",S),(d=document.getElementById("product-main-select"))==null||d.addEventListener("change",i=>{const l=i.target.value;W(l)}),(s=document.getElementById("subproduct-select"))==null||s.addEventListener("change",()=>{var O;const i=document.getElementById("subproduct-select"),l=document.getElementById("product-unit-price"),p=parseFloat((O=i==null?void 0:i.selectedOptions[0])==null?void 0:O.dataset.price)||0;l&&(l.value=p.toFixed(2))}),(u=document.getElementById("open-admin-clients-modal"))==null||u.addEventListener("click",()=>{L(),openModal("admin-clients-modal")}),(f=document.getElementById("open-new-client-modal"))==null||f.addEventListener("click",()=>{openModal("new-client-modal")}),(w=document.getElementById("new-client-form"))==null||w.addEventListener("submit",ne),(x=document.getElementById("edit-client-form"))==null||x.addEventListener("submit",ae),(E=document.getElementById("clients-table-body"))==null||E.addEventListener("click",i=>{const l=i.target;l.classList.contains("edit-client-btn")?k(l.dataset.clientId):l.classList.contains("delete-client-btn")&&R(l.dataset.clientId)}),(m=document.getElementById("admin-clients-table-body"))==null||m.addEventListener("click",i=>{const l=i.target;l.classList.contains("edit-client-btn")?k(l.dataset.clientId):l.classList.contains("delete-client-btn")&&R(l.dataset.clientId)}),(y=document.getElementById("open-admin-products-modal"))==null||y.addEventListener("click",async()=>{await h(),await T(),openModal("admin-products-modal")}),(I=document.getElementById("open-new-product-modal"))==null||I.addEventListener("click",async()=>{await h(),await C("parent-product-select"),X(),openModal("new-product-modal")}),(M=document.getElementById("new-product-form"))==null||M.addEventListener("submit",z),(_=document.getElementById("edit-product-form"))==null||_.addEventListener("submit",J),(g=document.getElementById("new-product-type"))==null||g.addEventListener("change",X),(H=document.getElementById("products-table-body"))==null||H.addEventListener("click",i=>{const l=i.target;l.classList.contains("edit-product-btn")?de(l.dataset.productId):l.classList.contains("delete-product-btn")&&se(l.dataset.productId)}),(F=document.getElementById("edit-product-type"))==null||F.addEventListener("change",async i=>{const l=i.target.value,p=document.getElementById("edit-parent-product-container");l==="PACKAGE"?(p==null||p.classList.remove("hidden"),await C("edit-parent-product-select")):p==null||p.classList.add("hidden")}),(q=document.getElementById("payment-form"))==null||q.addEventListener("submit",le),document.querySelectorAll("[data-close-modal]").forEach(i=>{i.addEventListener("click",l=>{l.preventDefault();const p=i.getAttribute("data-close-modal");closeModal(p)})}),document.addEventListener("click",i=>{document.querySelectorAll(".modal-overlay:not(.hidden)").forEach(p=>{i.target===p&&closeModal(p.id)})}),document.addEventListener("keydown",i=>{if(i.key==="Escape"){const l=document.querySelectorAll(".modal-overlay:not(.hidden)"),p=l[l.length-1];p&&closeModal(p.id)}})});
